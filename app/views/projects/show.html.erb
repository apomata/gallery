<p id="notice"><%= notice %></p>
<% if flash[:alert] %>
    <p class="flash-error"><%= flash[:alert] %></p>
<% end %>

<script type="text/javascript">
	function resizepicturearea() {

		var thumbnaildiv = $('#thumbnaildiv');
		var thumbnailbar = $('#thumbnailbar');
		var addpicbutton =  $('#addpicbutton');
		var picdescpanelbody = $('#picdescpanelbody');
		var mainpic = $('#mainpic');

		var picheight = mainpic.outerHeight( true );
		var addpicbuttonheight = $('#addpicbutton').outerHeight( true );
		var header = $('#picdescpanelhead').outerHeight( true );
		var bodypadding = picdescpanelbody.css('padding-top').replace(/[^-\d\.]/g, '');
		thumbnailbar.height(picheight);

		if($('picdescpanel').height > mainpic.height) {
			picdescpanelbody.height(picheight - (bodypadding*4));
		}
    }
</script>

<script type="text/javascript">
	function swappictures(imagesrc, description) {
		var mainpic = $('#mainpic');
		var picdescpanelbody = $('#picdescpanelbody');

		picdescpanelbody.html(description);
		mainpic.html(imagesrc);
	}
</script>

<div class="col-xs-11 col-xs-offset-1 pull-left">
		<h1 class="turninline-block">
			<strong>
				<% if @project.profiles.include?(current_user)%>
					<%= best_in_place @project, :title, :nil => "Click me to add content!", :ok_button => 'Save', :cancel_button => 'Cancel', :class => "panel panel-default turninline-block" %>
				<% else %>
				  <%= @project.title %>
				<% end %>
			</strong>
		</h1>

		<button>Like</button>
</div>

<div class="col-xs-7 col-xs-offset-1 container">
  <div class="row">
   	<% displayedpicture = @project.projectpictures.first%>
   	<%if !displayedpicture.nil?%>
    	<div id="mainpic" class="col-xs-4">
    	  <%= image_tag displayedpicture.picture.url(:medium), :class => 'fisrtpic img-responsive ', :onload => 'resizepicturearea()'%>
    	</div>
    	<div class="col-xs-4">
    	  <div id="picdescpanel" class="panel panel-default">
    	    <div id='picdescpanelhead' class="panel-heading">
    	      <h3 class="panel-title">Description</h3>
    	    </div>
    	    <div id='picdescpanelbody' class="panel-body scrollable">
    	        <%= displayedpicture.description %>
    	    </div>
    	  </div>
    	</div>
    	<div id="thumbnaildiv" class="col-xs-4 panel panel-default">
    	  <ul id='thumbnailbar' class="list-group scrollable">
    	    <% @project.projectpictures.each do |projectpicture| %>
    	      <li class="list-group-item">
    	        <%= image_tag projectpicture.picture.url(:thumb),
    	        :onclick => "swappictures( '#{image_tag projectpicture.picture.url(:medium), :class => 'fisrtpic', :onload => 'resizepicturearea()'}', '#{projectpicture.description}')"%>
    	      </li>
    	    <%end%>
    	  </ul>
    	</div>
    <%end%>
  </div>

	<%if !@project.embedcode.nil? %>
	<div class="panel panel-default">
		<div class="panel-heading">
			<h3 class="panel-title">Embed</h3>
		</div>
		<div class="panel-body">
			<div class="embed-responsive embed-responsive">
				<%tags = %w(a acronym b strong i em li ul ol h1 h2 h3 h4 h5 h6 blockquote br cite sub sup ins p iframe)%>
				<%attributes = %w(href title class id width height src frameborder allowfullscreen)%>
				<%=sanitize( @project.embedcode, tags: tags, attributes: attributes).html_safe%>
			</div>
		</div>
	</div>
	<%end%>


	<div class="panel panel-default">
		<div class="panel-heading">
			<h3 class="panel-title">Description</h3>
		</div>
		<div class="panel-body">
			<% if @project.profiles.include?(current_user)%>
				<%= best_in_place @project, :description, type: :textarea,:nil => "Click me to add content!", :ok_button => 'Save', :cancel_button => 'Cancel', :class => 'turnblock' %>
			<% else %>
				<%= @project.description %>
			<% end %>
		</div>
	</div>

	<div class="panel panel-primary">
		<div class="panel-heading">
			<h3 class="panel-title">Special Links</h3>
		</div>
		<div class="panel-body">
			<ul class="list-group">
				<%# @project.profiles.each do |profile| %>
					<li class="list-group-item">
						links will go here
					</li>
				<%#end%>
			</ul>
		</div>
	</div>
</div>


<div class="col-xs-3 col-xs-offset-1 container">
	<% if @project.profiles.include?(current_user)%>
	  <%= link_to 'Edit', edit_project_path(@project) %>
	<% end %>
	<div class="panel panel-primary">
		<div class="panel-heading">
			<h3 class="panel-title">Creators</h3>
		</div>
		<div class="panel-body">
			<ul class="list-group">
				<% @project.profiles.each do |profile| %>
					<li class="list-group-item">
						<%= image_tag profile.avatar.url(:thumb)%>
						<%= link_to profile.first_name, profile_path(profile)%>
					</li>
				<%end%>
			</ul>
		</div>
	</div>
	<div class="panel panel-primary">
		<div class="panel-heading">
			<h3 class="panel-title">Other projects by the creators</h3>
		</div>
		<div class="panel-body">
			<ul class="list-group ">
				<%projects = otherprojects%>
				<% projects.keys.each do |project| %>
					<li class="list-group-item">
						<% pic = project.projectpictures.first%>
						<% if !pic.nil? && !pic.picture.nil? %>
							<%= image_tag pic.picture.url(:thumb)%>
						<%end%>
						<%= link_to "#{project.title}", project_path(project)%>
					</li>
				<%end%>
			</ul>
		</div>
	</div>
</div>
